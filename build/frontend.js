(()=>{var e,t={275:(e,t,n)=>{"use strict";const r=window.React,o=window.wc.blocksCheckout,a=window.wp.i18n,c=JSON.parse('{"apiVersion":2,"name":"woocommerce/eu-vat-number","version":"1.0.0","title":"EU VAT Number","parent":["woocommerce/checkout-fields-block"],"category":"woocommerce","icon":"cart","description":"The EU VAT Number extension lets you collect and validate EU VAT numbers during checkout to identify B2B transactions verses B2C. IP Addresses can also be validated to ensure they match the billing address. EU businesses with a valid VAT number can have their VAT removed prior to payment.","supports":{"html":false},"textdomain":"woocommerce-eu-vat-number","attributes":{"lock":{"type":"object","default":{"remove":true,"move":false}}}}'),i=window.wp.element,u=window.wp.compose;function s(e,t){return e===t}function l(e,t){return t}const d=window.wp.components,m=window.wc.wcSettings;var p=n(485),v=n.n(p);const f=window.wp.data,b=({shouldValidateIp:e,billingCountry:t,ipAddress:n,ipCountry:c,validation:u,checkoutExtensionData:s})=>{const l=(0,m.getSetting)("allowedCountries",{}),{setExtensionData:d}=s;let p=t;l[t]&&(p=l[t]);const{extensions:v}=(0,f.useSelect)((e=>e("wc/store/cart").getCartData())),{cart_has_digital_goods:b}=v["woocommerce-eu-vat-number"],{setValidationErrors:h,clearValidationError:w,getValidationError:g}=u,[_,E]=(0,i.useState)(!1),[y,k]=(0,i.useState)(!1),S="billing_vat_number_ip_address_notice",x=(0,a.sprintf)(/* translators: %1$s is the user's IP address, %2$s is the billing country name */ /* translators: %1$s is the user's IP address, %2$s is the billing country name */
(0,a.__)("Your IP Address (%1$s) does not match your billing country (%2$s). European VAT laws require your IP address to match your billing country when purchasing digital goods in the EU. Please confirm you are located within your billing country using the checkbox above.","woocommerce-eu-vat-number"),n,p),A=e&&b&&t!==c;if((0,i.useEffect)((()=>(!_&&A&&h({[S]:{message:x,hidden:!y}}),_&&w(S),()=>{w(S)})),[h,_,y]),!A)return null;const C=g(S);return(0,r.createElement)("div",{className:"wc-eu-vat-checkout-ip-notice"},(0,r.createElement)("div",{className:"wc-eu-vat-checkout-ip-notice__checkbox-container"},(0,r.createElement)(o.CheckboxControl,{name:"location_confirmation",className:!1===C?.hidden?"has-error":"",label:(0,i.createInterpolateElement)((0,a.sprintf)(/* translators: %s is the billing country full name, e.g. Finland, France, or Spain. */ /* translators: %s is the billing country full name, e.g. Finland, France, or Spain. */
(0,a.__)("I am established, have my permanent address, or usually reside within <strong>%s</strong>.","woocommerce-eu-vat-number"),p),{strong:(0,r.createElement)("strong",null)}),checked:_,onChange:e=>{y||k(!0),E(e),d("woocommerce-eu-vat-number","location_confirmation",e)}})),C?.message&&!C?.hidden?(0,r.createElement)("div",{className:"wc-eu-vat-checkout-ip-notice__error wc-block-components-validation-error"},C.message):null)},h=({defaultTitle:e=(0,a.__)("Step","woocommerce-eu-vat-number"),defaultDescription:t=(0,a.__)("Step description text.","woocommerce-eu-vat-number"),defaultShowStepNumber:n=!0})=>({title:{type:"string",default:e},description:{type:"string",default:t},showStepNumber:{type:"boolean",default:n}}),w=({title:e,stepHeadingContent:t})=>(0,r.createElement)("div",{className:"wc-block-components-checkout-step__heading"},(0,r.createElement)("h2",{"aria-hidden":"true",className:"wc-block-components-checkout-step__title wc-block-components-title"},e),!!t&&(0,r.createElement)("span",{className:"wc-block-components-checkout-step__heading-content"},t)),g=(_=h({}),e=>t=>{const n=((e,t)=>{const n=[];return Object.keys(e).forEach((r=>{if(void 0!==t[r])switch(e[r].type){case"boolean":n[r]="false"!==t[r]&&!1!==t[r];break;case"number":n[r]=parseInt(t[r],10);break;case"array":case"object":n[r]=JSON.parse(t[r]);break;default:n[r]=t[r]}else n[r]=e[r].default})),n})(_,t);return(0,r.createElement)(e,{...t,...n})})((({id:e,className:t,title:n,legend:o,description:a,children:c,disabled:i=!1,showStepNumber:u=!0,stepHeadingContent:s=(()=>{})})=>{const l=o||n?"fieldset":"div";return(0,r.createElement)(l,{className:v()(t,"wc-block-components-checkout-step",{"wc-block-components-checkout-step--with-step-number":u,"wc-block-components-checkout-step--disabled":i}),id:e,disabled:i},!(!o&&!n)&&(0,r.createElement)("legend",{className:"screen-reader-text"},o||n),!!n&&(0,r.createElement)(w,{title:n,stepHeadingContent:s()}),(0,r.createElement)("div",{className:"wc-block-components-checkout-step__container"},!!a&&(0,r.createElement)("p",{className:"wc-block-components-checkout-step__description"},a),(0,r.createElement)("div",{className:"wc-block-components-checkout-step__content"},c)))}));var _;const E=(0,u.withInstanceId)((e=>{const{setValidationErrors:t,clearValidationError:n,getValidationError:c}=e.validation,{checkoutExtensionData:u}=e,{billingAddress:p,shippingAddress:h,needsShipping:w,extensions:_}=(0,f.useSelect)((e=>{const t=e("wc/store/cart").getCartData();return{cartItems:t.items,billingAddress:t.billingAddress,shippingAddress:t.shippingAddress,extensions:t.extensions,needsShipping:t.needsShipping}})),{b2b_required:E,eu_countries:y,uk_ni_notice:k,input_label:S,input_description:x,failure_handler:A,use_shipping_country:C}=window.wc_eu_vat_params,N=C&&w?h.country:p.country,{title:T=(0,a.__)("VAT Number","woocommerce-eu-vat-number"),description:O="",showStepNumber:V=!0}=e,{woocommerce_eu_vat_number_validate_ip:I,ip_address:D,ip_country:R}=(0,m.getSetting)("woocommerce-eu-vat-number_data"),P="yes"===I,[j,q]=(0,i.useState)(!1),[L,B]=(0,i.useState)(_["woocommerce-eu-vat-number"]?.vat_number),[Z]=(ie=L,se=s,le=(0,r.useReducer)(l,ie),de=le[0],me=le[1],pe=function(e,t,n){var o=this,a=(0,r.useRef)(null),c=(0,r.useRef)(0),i=(0,r.useRef)(null),u=(0,r.useRef)([]),s=(0,r.useRef)(),l=(0,r.useRef)(),d=(0,r.useRef)(e),m=(0,r.useRef)(!0);d.current=e;var p="undefined"!=typeof window,v=!t&&0!==t&&p;if("function"!=typeof e)throw new TypeError("Expected a function");t=+t||0;var f=!!(n=n||{}).leading,b=!("trailing"in n)||!!n.trailing,h="maxWait"in n,w="debounceOnServer"in n&&!!n.debounceOnServer,g=h?Math.max(+n.maxWait||0,t):null;(0,r.useEffect)((function(){return m.current=!0,function(){m.current=!1}}),[]);var _=(0,r.useMemo)((function(){var e=function(e){var t=u.current,n=s.current;return u.current=s.current=null,c.current=e,l.current=d.current.apply(n,t)},n=function(e,t){v&&cancelAnimationFrame(i.current),i.current=v?requestAnimationFrame(e):setTimeout(e,t)},r=function(e){if(!m.current)return!1;var n=e-a.current;return!a.current||n>=t||n<0||h&&e-c.current>=g},_=function(t){return i.current=null,b&&u.current?e(t):(u.current=s.current=null,l.current)},E=function e(){var o=Date.now();if(r(o))return _(o);if(m.current){var i=t-(o-a.current),u=h?Math.min(i,g-(o-c.current)):i;n(e,u)}},y=function(){if(p||w){var d=Date.now(),v=r(d);if(u.current=[].slice.call(arguments),s.current=o,a.current=d,v){if(!i.current&&m.current)return c.current=a.current,n(E,t),f?e(a.current):l.current;if(h)return n(E,t),e(a.current)}return i.current||n(E,t),l.current}};return y.cancel=function(){i.current&&(v?cancelAnimationFrame(i.current):clearTimeout(i.current)),c.current=0,u.current=a.current=s.current=i.current=null},y.isPending=function(){return!!i.current},y.flush=function(){return i.current?_(Date.now()):l.current},y}),[f,h,t,g,b,v,p,w]);return _}((0,r.useCallback)((function(e){return me(e)}),[me]),800,ue),ve=(0,r.useRef)(ie),se(ve.current,ie)||(pe(ie),ve.current=ie),[de,pe]),[U,F]=(0,i.useState)(_["woocommerce-eu-vat-number"]?.vat_number),[M,H]=(0,i.useState)(!1),[z,G]=(0,i.useState)("yes"===E&&-1!==y.indexOf(N)),[J,K]=(0,i.useState)(-1!==y.indexOf(N)),[W,Y]=(0,i.useState)("GB"===N),$=(0,i.useRef)(!0),X="billing_vat_number",Q="billing_vat_number_error",ee="required_vat_number_error",te="vat_verification_in_progress",ne="eu-vat-extra-css",re=c(Q),oe=c(ee),ae=!1===re?.hidden&&""!==re?.message||!1===oe?.hidden&&""!==oe?.message,ce=c(te);var ie,ue,se,le,de,me,pe,ve;(0,i.useEffect)((()=>{fe()}),[Z]),(0,i.useEffect)((()=>{if($.current)$.current=!1;else{if(!L?.length)return;H(!0),he()}}),[L]),(0,i.useEffect)((()=>{B(_["woocommerce-eu-vat-number"]?.vat_number)}),[]),(0,i.useEffect)((()=>{u.setExtensionData("woocommerce-eu-vat-number","vat_number",null!=Z?Z:"")}),[Z]),(0,i.useEffect)((()=>{G("yes"===E&&-1!==y.indexOf(N))}),[E,N,y]),(0,i.useEffect)((()=>{u.setExtensionData("woocommerce-eu-vat-number","location_confirmation",!1)}),[u.setExtensionData]),(0,i.useEffect)((()=>{K(-1!==y.indexOf(N)),Y("GB"===N)}),[y,N]),(0,i.useEffect)((()=>{!z||"string"==typeof Z&&Z.length>0||t({[ee]:{message:(0,a.__)("VAT number is required.","woocommerce-eu-vat-number"),hidden:!0}})}),[z,t,ee]);const fe=()=>{Z!==U&&(z&&(null==Z||"string"==typeof Z&&0===Z.length)&&t({[Q]:{message:(0,a.__)("VAT number is required.","woocommerce-eu-vat-number"),hidden:!1}}),(0,o.extensionCartUpdate)({namespace:"woocommerce-eu-vat-number",data:{vat_number:Z},cartPropsToReceive:["extensions"]}).then((()=>{F(Z),n(te),n(ee),z||Z||n(Q),H(!1)})))};(0,i.useEffect)((()=>{const e=c(Q);_["woocommerce-eu-vat-number"]?.validation.error||n(Q),!Z&&e?.hidden||(z||Z?M||!(_["woocommerce-eu-vat-number"]?.validation?.error||e?.message?.length>0)?n(Q):t({[Q]:{message:_["woocommerce-eu-vat-number"]?.validation.error,hidden:!1}}):n(Q))}),[_["woocommerce-eu-vat-number"]?.validation.error,M]),(0,i.useEffect)((()=>{"string"==typeof Z&&Z.length>0&&(!((e,t)=>{const n={AT:"U[A-Z\\d]{8}",BE:"0\\d{9}",BG:"\\d{9,10}",CY:"\\d{8}[A-Z]",CZ:"\\d{8,10}",DE:"\\d{9}",DK:"(\\d{2} ?){3}\\d{2}",EE:"\\d{9}",EL:"\\d{9}",ES:"[A-Z]\\d{7}[A-Z]|\\d{8}[A-Z]|[A-Z]\\d{8}",FI:"\\d{8}",FR:"([A-Z]{2}|[A-Z0-9]{2})\\d{9}",XI:"\\d{9}|\\d{12}|(GD|HA)\\d{3}",HR:"\\d{11}",HU:"\\d{8}",IE:"[A-Z\\d]{8,10}",IT:"\\d{11}",LT:"(\\d{9}|\\d{12})",LU:"\\d{8}",LV:"\\d{11}",MT:"\\d{8}",NL:"\\d{9}B\\d{2}",PL:"\\d{10}",PT:"\\d{9}",RO:"\\d{2,10}",SE:"\\d{12}",SI:"\\d{8}",SK:"\\d{10}"};return!!n[e]&&null!==new RegExp(n[e]).exec(t)})(N,Z)&&"reject"===A||!_["woocommerce-eu-vat-number"]?.validation?.valid&&Z===_["woocommerce-eu-vat-number"]?.vat_number&&"reject"===A)&&t({[Q]:{message:_["woocommerce-eu-vat-number"]?.validation.error,hidden:!1}})}),[]);const be=({id:e,message:t})=>ae?(0,r.createElement)("div",{className:"wc-block-components-validation-error",role:"alert"},(0,r.createElement)("p",{id:e},t)):null,he=()=>{t({[te]:{message:(0,a.__)("Applying VAT ...","woocommerce-eu-vat-number"),hidden:!1}})};return J?(0,r.createElement)(g,{id:"shipping-fields",className:v()("wc-block-checkout__shipping-fields",ne),title:T,description:O,showStepNumber:V},(0,r.createElement)("div",null,(0,r.createElement)("div",{className:v()("wc-block-components-text-input",ne,{"is-active":j||!!Z},{"has-error":ae})},(0,r.createElement)("input",{type:"text","aria-label":S,id:X,value:L||"",onChange:e=>{(e=>{const{value:n}=e.target;"string"==typeof n&&0===n.length&&z&&t({[Q]:{message:(0,a.__)("VAT Number is required.","woocommerce-eu-vat-number"),hidden:!1}}),B(n)})(e)},onFocus:()=>{q(!0)},onBlur:()=>{q(!1)},"aria-invalid":!0===ae,disabled:!1,required:z}),(0,r.createElement)("label",{htmlFor:X},S,!0===z?null:" (optional)"),(0,r.createElement)(be,{id:Q,message:c(Q)?.message}),(0,r.createElement)(be,{id:ee,message:c(ee)?.message}),(0,r.createElement)((()=>void 0===ce||ce?.hidden?null:(0,r.createElement)("div",{style:{fontSize:".75em"}},(0,r.createElement)("p",{id:te,style:{paddingTop:"4px"}},ce?.message,(0,r.createElement)(d.Spinner,null)))),null),(0,r.createElement)("div",{className:"wc-eu-vat-checkout-uk-notice"},(0,r.createElement)("div",null,(0,r.createElement)("span",null,x)),(0,r.createElement)("span",null,W?k:null))),!Z&&"no"===E||!Z&&!E?(0,r.createElement)(b,{validation:e.validation,ipAddress:D,ipCountry:R,billingCountry:p.country,shouldValidateIp:P,checkoutExtensionData:u}):null)):(0,r.createElement)(r.Fragment,null)})),y=".wc-block-components-address-card",k=(()=>{const e={vatNumber:null,replacementsCount:0,initialized:!1};return{get:t=>{try{return e[t]}catch(e){return null}},set:(t,n)=>{try{e[t]=n}catch(e){}}}})(),S=e=>{let t=0;return Promise.race([new Promise((n=>{const r=setInterval((()=>{if(t++>=50)return clearInterval(r),void n(null);const o=e();o&&(clearInterval(r),n(o))}),10);window.addEventListener("pagehide",(()=>clearInterval(r))),window.addEventListener("unload",(()=>clearInterval(r)))})),new Promise((e=>{setTimeout((()=>e(null)),5e3)}))])},x=async()=>{try{var e;const t=await S((()=>{try{const e=(0,f.select)("wc/store/cart");if(!e)return null;const t=e.getCartData();return void 0!==t?.extensions?.["woocommerce-eu-vat-number"]?.vat_number?t:null}catch(e){return null}}));return null!==(e=t?.extensions?.["woocommerce-eu-vat-number"]?.vat_number)&&void 0!==e?e:""}catch(e){return""}},A=e=>{try{var t;if(k.get("replacementsCount")>=2)return!1;const n=null!==(t=k.get("vatNumber"))&&void 0!==t?t:"";if(!e)return!1;const r=e.querySelectorAll(".wc-block-components-address-card__address-section span");let o=!1;return r?.forEach((e=>{"{vat_id}"===e?.textContent&&(e.textContent=n,k.set("replacementsCount",(k.get("replacementsCount")||0)+1),o=!0)})),o}catch(e){return!1}},C=async()=>{if(!k.get("initialized")){k.set("initialized",!0);try{const[e,t]=await Promise.all([x(),S((()=>document.querySelector(".wc-block-checkout__form")))]);if(!t)return;k.set("vatNumber",e);const n=document.querySelectorAll(y);if(n.length>0&&n.forEach(A),k.get("replacementsCount")<2){const e=new MutationObserver((()=>{k.get("replacementsCount")>=2?e.disconnect():(document.querySelectorAll(y).forEach(A),k.get("replacementsCount")>=2&&e.disconnect())}));e.observe(t,{childList:!0,subtree:!0})}}catch(e){}}},N=()=>{try{if("loading"===document.readyState)return void document.addEventListener("DOMContentLoaded",C);if("interactive"===document.readyState||"complete"===document.readyState)return void C();document.addEventListener("readystatechange",(()=>{k.get("initialized")||"interactive"!==document.readyState&&"complete"!==document.readyState||C()}))}catch(e){}},T={metadata:{...c,attributes:{...c.attributes,...h({defaultTitle:(0,a.__)("VAT Number","woocommerce-eu-vat-number"),defaultDescription:"",defaultShowStepNumber:!0})}},component:e=>(0,r.createElement)(E,{isEditing:!1,...e})};N(),(0,o.registerCheckoutBlock)(T)},485:(e,t)=>{var n;!function(){"use strict";var r={}.hasOwnProperty;function o(){for(var e=[],t=0;t<arguments.length;t++){var n=arguments[t];if(n){var a=typeof n;if("string"===a||"number"===a)e.push(n);else if(Array.isArray(n)){if(n.length){var c=o.apply(null,n);c&&e.push(c)}}else if("object"===a)if(n.toString===Object.prototype.toString)for(var i in n)r.call(n,i)&&n[i]&&e.push(i);else e.push(n.toString())}}return e.join(" ")}e.exports?(o.default=o,e.exports=o):void 0===(n=function(){return o}.apply(t,[]))||(e.exports=n)}()}},n={};function r(e){var o=n[e];if(void 0!==o)return o.exports;var a=n[e]={exports:{}};return t[e](a,a.exports,r),a.exports}r.m=t,e=[],r.O=(t,n,o,a)=>{if(!n){var c=1/0;for(l=0;l<e.length;l++){for(var[n,o,a]=e[l],i=!0,u=0;u<n.length;u++)(!1&a||c>=a)&&Object.keys(r.O).every((e=>r.O[e](n[u])))?n.splice(u--,1):(i=!1,a<c&&(c=a));if(i){e.splice(l--,1);var s=o();void 0!==s&&(t=s)}}return t}a=a||0;for(var l=e.length;l>0&&e[l-1][2]>a;l--)e[l]=e[l-1];e[l]=[n,o,a]},r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={343:0,834:0};r.O.j=t=>0===e[t];var t=(t,n)=>{var o,a,[c,i,u]=n,s=0;if(c.some((t=>0!==e[t]))){for(o in i)r.o(i,o)&&(r.m[o]=i[o]);if(u)var l=u(r)}for(t&&t(n);s<c.length;s++)a=c[s],r.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return r.O(l)},n=globalThis.webpackChunkwoocommerce_eu_vat_number=globalThis.webpackChunkwoocommerce_eu_vat_number||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var o=r.O(void 0,[834],(()=>r(275)));o=r.O(o)})();